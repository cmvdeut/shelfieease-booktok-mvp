{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/MAUREEN/DEV/ShelfieEase/shelfie-ease/app/scan/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport Link from 'next/link';\nimport Script from 'next/script';\n\n// QuaggaJS / Quagga2 types\ndeclare global {\n  interface Window {\n    Quagga: any;\n    Quagga2?: any; // Quagga2 als alternatief\n  }\n}\n\nexport default function ScanPage() {\n  const [isScanning, setIsScanning] = useState(false);\n  const [manualIsbn, setManualIsbn] = useState('');\n  const [scannedBook, setScannedBook] = useState<any>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [debugLogs, setDebugLogs] = useState<string[]>([]);\n  const [showDebug, setShowDebug] = useState(false);\n  const [quaggaLoaded, setQuaggaLoaded] = useState(false);\n  const [quagga2Loaded, setQuagga2Loaded] = useState(false);\n  const [usingQuagga2, setUsingQuagga2] = useState(false);\n  const isProcessingRef = useRef<boolean>(false);\n\n  // Veilige serialisatie functie die omgaat met circulaire referenties en React/DOM elementen\n  const safeStringify = (obj: any, depth = 0): string => {\n    if (depth > 10) return '[Max depth reached]';\n    \n    // Handle primitives\n    if (obj === null) return 'null';\n    if (obj === undefined) return 'undefined';\n    if (typeof obj === 'string') return `\"${obj}\"`;\n    if (typeof obj !== 'object') return String(obj);\n    \n    // Handle special objects\n    if (obj instanceof Error) return `Error: ${obj.message}`;\n    if (obj instanceof Date) return obj.toISOString();\n    if (obj instanceof HTMLElement) return `[HTMLElement: ${obj.tagName}]`;\n    if (obj instanceof Element) return `[Element: ${obj.tagName || 'Unknown'}]`;\n    \n    // Check for React elements\n    if (obj.$$typeof) return '[React Element]';\n    if (obj._owner) return '[React Component]';\n    if (obj.__reactFiber) return '[React Fiber]';\n    \n    // Handle arrays\n    if (Array.isArray(obj)) {\n      const items = obj.slice(0, 5).map(item => safeStringify(item, depth + 1));\n      const more = obj.length > 5 ? `... (+${obj.length - 5} more)` : '';\n      return `[${items.join(', ')}${more}]`;\n    }\n    \n    // Handle objects - gebruik Map om circulaire referenties te detecteren\n    const seen = new Map();\n    let refCounter = 0;\n    \n    const stringifyValue = (val: any, currentDepth: number): string => {\n      if (currentDepth > 5) return '[Max depth]';\n      \n      if (val === null || val === undefined) return String(val);\n      if (typeof val !== 'object') return String(val);\n      \n      // Check for circular reference\n      if (seen.has(val)) {\n        const refId = seen.get(val) || `#${++refCounter}`;\n        if (!seen.has(val)) seen.set(val, refId);\n        return `[Circular ${refId}]`;\n      }\n      \n      // Check for React/DOM elements\n      if (val instanceof HTMLElement) return `[HTMLElement: ${val.tagName}]`;\n      if (val instanceof Element) return `[Element]`;\n      if (val.$$typeof) return '[React Element]';\n      if (val._owner) return '[React Component]';\n      if (val.__reactFiber) return '[React Fiber]';\n      \n      seen.set(val, `#${++refCounter}`);\n      \n      if (Array.isArray(val)) {\n        return `[Array(${val.length})]`;\n      }\n      \n      try {\n        const keys = Object.keys(val).slice(0, 10);\n        const pairs = keys.map(key => {\n          try {\n            return `\"${key}\": ${stringifyValue(val[key], currentDepth + 1)}`;\n          } catch {\n            return `\"${key}\": [Error serializing]`;\n          }\n        });\n        return `{${pairs.join(', ')}}`;\n      } catch {\n        return '[Object]';\n      }\n    };\n    \n    try {\n      const keys = Object.keys(obj).slice(0, 10);\n      const pairs = keys.map(key => {\n        try {\n          return `\"${key}\": ${stringifyValue(obj[key], depth + 1)}`;\n        } catch {\n          return `\"${key}\": [Error]`;\n        }\n      });\n      return `{${pairs.join(', ')}}`;\n    } catch {\n      return '[Object]';\n    }\n  };\n\n  // Debug logging functie die ook naar het scherm schrijft\n  const debugLog = (message: string, data?: any) => {\n    const timestamp = new Date().toLocaleTimeString();\n    let logMessage: string;\n    \n    if (data !== undefined) {\n      try {\n        const serialized = safeStringify(data);\n        logMessage = `[${timestamp}] ${message}: ${serialized}`;\n      } catch (e) {\n        logMessage = `[${timestamp}] ${message}: [Error serializing data]`;\n      }\n    } else {\n      logMessage = `[${timestamp}] ${message}`;\n    }\n    \n    // Log naar console (voor desktop debugging) - gebruik console.log direct voor objecten\n    if (data !== undefined) {\n      console.log(`[${timestamp}] ${message}`, data);\n    } else {\n      console.log(logMessage);\n    }\n    \n    // Voeg toe aan debug logs (voor mobiel) - gebruik veilige string versie\n    setDebugLogs(prev => {\n      const newLogs = [...prev, logMessage];\n      // Houd alleen laatste 50 logs\n      return newLogs.slice(-50);\n    });\n  };\n\n  // Cleanup bij unmount\n  useEffect(() => {\n    return () => {\n      stopCamera();\n    };\n  }, []);\n\n  /**\n   * Callback functie voor barcode scanning - verwerkt gedetecteerde barcodes\n   * QuaggaJS result heeft een codeResult object met code en format\n   */\n  const handleBarcodeResult = (result: any) => {\n    try {\n      // QuaggaJS codeResult structuur: { code: string, format: string }\n      const code = result.code ? result.code.trim() : String(result).trim();\n      const format = result.format || 'unknown';\n      \n      debugLog('ðŸ” BARCODE DETECTED!', {\n        code: code,\n        length: code.length,\n        format: format,\n        resultType: typeof result\n      });\n      \n      // Maak code schoon (verwijder niet-numerieke tekens behalve X voor ISBN-10)\n      const cleanCode = code.replace(/[^0-9X]/gi, '');\n      debugLog('ðŸ§¹ Cleaned code', { cleaned: cleanCode, length: cleanCode.length });\n      \n      // Valideer ISBN: 10 cijfers (mogelijk met X) of 13 cijfers\n      const isISBN10 = /^\\d{9}[\\dX]$/i.test(cleanCode);\n      const isISBN13 = /^\\d{13}$/.test(cleanCode);\n      \n      debugLog('ðŸ“Š Validation', {\n        isISBN10: isISBN10,\n        isISBN13: isISBN13,\n        test10: /^\\d{9}[\\dX]$/i.test(cleanCode),\n        test13: /^\\d{13}$/.test(cleanCode)\n      });\n      \n      if (isISBN10 || isISBN13) {\n        debugLog(`âœ… VALID ISBN DETECTED! ${cleanCode} (${isISBN10 ? 'ISBN-10' : 'ISBN-13'})`);\n        \n        // Set flag IMMEDIATELY and synchronously\n        isProcessingRef.current = true;\n        \n        // Stop scanner FIRST - alleen bij geldige ISBN\n        const scanner = window.Quagga2 || window.Quagga;\n        try {\n          scanner.stop();\n          debugLog('ðŸ›‘ Scanner stopped after valid ISBN detection');\n        } catch (e) {\n          debugLog('âš ï¸ Error stopping scanner', { error: String(e) });\n        }\n        \n        // Vibratie feedback op mobiel\n        if (navigator.vibrate) {\n          navigator.vibrate(200);\n        }\n        \n        // Start lookup\n        lookupIsbn(cleanCode);\n      } else {\n        debugLog('âš ï¸ Barcode detected but not a valid ISBN', {\n          original: code,\n          cleaned: cleanCode,\n          length: cleanCode.length,\n          isISBN10: isISBN10,\n          isISBN13: isISBN13\n        });\n        // Continue scanning - geen stop, geen flag reset nodig\n      }\n    } catch (e) {\n      debugLog('âŒ Error processing barcode result', { error: String(e) });\n      console.error('âŒ Error processing barcode result:', e, result);\n      // Reset processing flag bij error\n      isProcessingRef.current = false;\n    }\n  };\n\n  /**\n   * Start de barcode scanning met QuaggaJS. Deze functie wordt aangeroepen wanneer de\n   * gebruiker op de \"Start scan\" button klikt. Het vraagt camera toegang aan\n   * en begint met decoderen. Als de browser toestemming weigert (bijv. omdat\n   * de site niet over HTTPS wordt geserveerd), wordt een foutmelding getoond.\n   */\n  const startCamera = async () => {\n    // Reset processing flag bij het starten van de camera - EERST\n    isProcessingRef.current = false;\n    \n    if (isScanning) return; // Al aan het scannen\n    \n    // Detecteer platform VOORDAT we scanner kiezen\n    const userAgent = navigator.userAgent;\n    const isAndroid = /Android/i.test(userAgent);\n    const isIOS = /iPhone|iPad|iPod/i.test(userAgent);\n    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent) || \n                     (window.innerWidth <= 768);\n    \n    debugLog('Platform detectie', {\n      isAndroid,\n      isIOS,\n      isMobile,\n      userAgent: userAgent.substring(0, 100) // Eerste 100 chars voor privacy\n    });\n    \n    // Strategie: Android gebruikt QuaggaJS (bewezen werkend), andere platforms Quagga2\n    let scanner: any;\n    let scannerName: string;\n    let isQuagga2: boolean;\n    \n    // Android: gebruik QuaggaJS (bewezen werkend in SeniorEase)\n    // iOS/Desktop: gebruik Quagga2 (onderhouden versie)\n    if (isAndroid) {\n      // Android: QuaggaJS (bewezen werkend)\n      if (window.Quagga) {\n        scanner = window.Quagga;\n        scannerName = 'QuaggaJS';\n        isQuagga2 = false;\n        debugLog('ðŸ“± Android: Gebruik QuaggaJS (bewezen werkend in SeniorEase)');\n      } else {\n        setError('QuaggaJS niet beschikbaar. Wacht even en probeer opnieuw.');\n        return;\n      }\n    } else {\n      // iOS/Desktop: Quagga2 (onderhouden versie)\n      const hasQuagga2 = window.Quagga2 || (window.Quagga && (window.Quagga as any).ImageDebug);\n      \n      if (hasQuagga2) {\n        scanner = window.Quagga2 || window.Quagga;\n        scannerName = 'Quagga2';\n        isQuagga2 = true;\n        debugLog('ðŸ“¦ Gebruik Quagga2 (onderhouden versie met debug overlay)', {\n          platform: isIOS ? 'iOS' : 'Desktop',\n          hasQuagga2: !!window.Quagga2,\n          hasImageDebug: !!(window.Quagga && (window.Quagga as any).ImageDebug)\n        });\n      } else if (window.Quagga) {\n        scanner = window.Quagga;\n        scannerName = 'QuaggaJS';\n        isQuagga2 = false;\n        debugLog('ðŸ“¦ Gebruik QuaggaJS (backup)');\n      } else {\n        setError('Geen scanner beschikbaar. Wacht even en probeer opnieuw.');\n        return;\n      }\n    }\n    \n    setUsingQuagga2(isQuagga2);\n    \n    setError('');\n    setScannedBook(null);\n    setIsScanning(true); // Zet state eerst zodat container div wordt gerenderd\n    \n    // Wacht tot React de DOM heeft geÃ¼pdatet en de container div bestaat\n    await new Promise(resolve => setTimeout(resolve, 100));\n    \n    // Check nu of container div bestaat\n    const container = document.getElementById('quagga-container');\n    if (!container) {\n      setError('Scanner container niet gevonden. Probeer het opnieuw.');\n      setIsScanning(false);\n      return;\n    }\n    \n    try {\n      \n      debugLog(`ðŸ“· Starting ${scannerName} barcode scanner...`);\n      debugLog('Container check', { exists: !!container });\n      debugLog('Scanner check', { \n        quagga2: !!window.Quagga2, \n        quagga: !!window.Quagga,\n        using: scannerName,\n        isMobile: isMobile\n      });\n\n      // Configuratie - EXACT zoals SeniorEase (bewezen werkend op Android)\n      // SeniorEase gebruikt deze exacte configuratie en werkt razendsnel\n      const config: any = {\n        inputStream: {\n          name: \"Live\",\n          type: \"LiveStream\",\n          target: container,\n          constraints: {\n            video: {\n              facingMode: { exact: \"environment\" } // Force achtercamera (zoals SeniorEase)\n            },\n            width: 640,\n            height: 480\n          }\n        },\n        decoder: {\n          readers: [\"ean_reader\", \"code_128_reader\", \"code_39_reader\"] // Exact zoals SeniorEase\n        },\n        locate: true,\n        locator: {\n          patchSize: \"medium\", // Exact zoals SeniorEase\n          halfSample: true // Exact zoals SeniorEase\n        }\n      };\n      \n      // Alleen Quagga2 krijgt extra instellingen (niet voor Android/QuaggaJS)\n      if (isQuagga2) {\n        config.numOfWorkers = 0; // 0 nodig voor debug overlay\n        config.frequency = isIOS ? 8 : 5;\n        config.decoder = {\n          ...config.decoder,\n          debug: {\n            drawBoundingBox: true,\n            showFrequency: false,\n            drawScanline: true,\n            showPattern: false\n          }\n        };\n      }\n      \n      debugLog('Configuratie (EXACT SeniorEase)', {\n        platform: isAndroid ? 'Android' : (isIOS ? 'iOS' : 'Desktop'),\n        scanner: scannerName,\n        config: JSON.stringify({\n          constraints: config.inputStream.constraints,\n          decoder: config.decoder,\n          locator: config.locator\n        }, null, 2)\n      });\n      \n      // Log config veilig - verwijder DOM elementen\n      const safeConfig = {\n        inputStream: {\n          name: config.inputStream.name,\n          type: config.inputStream.type,\n          constraints: config.inputStream.constraints\n        },\n        decoder: config.decoder,\n        locate: config.locate,\n        locator: config.locator\n      };\n      debugLog('Scanner configuratie (EXACT SeniorEase)', { \n        isMobile,\n        scanner: scannerName,\n        config: JSON.stringify(safeConfig, null, 2)\n      });\n\n      // Initialiseer scanner (Quagga2 of QuaggaJS) - scanner is al gedeclareerd boven\n      let initSuccess = false;\n      try {\n        await new Promise<void>((resolve, reject) => {\n          scanner.init(config, (err: any) => {\n            if (err) {\n              debugLog(`âŒ ${scannerName} init error (eerste poging)`, { error: String(err), errorName: err?.name });\n              \n              // Fallback voor mobiel: probeer met vereenvoudigde constraints\n              if (isMobile) {\n                debugLog('ðŸ”„ Probeer fallback configuratie voor mobiel...');\n                const fallbackConfig = {\n                  ...config,\n                  inputStream: {\n                    ...config.inputStream,\n                    constraints: {\n                      video: {\n                        facingMode: \"environment\" // Geen exact, laat browser kiezen\n                        // Geen width/height constraints - maximale flexibiliteit\n                      }\n                    }\n                  },\n                  locator: {\n                    ...config.locator,\n                    patchSize: \"medium\", // Grotere patches als fallback\n                    halfSample: true\n                  }\n                };\n                \n                scanner.init(fallbackConfig, (fallbackErr: any) => {\n                  if (fallbackErr) {\n                    debugLog(`âŒ ${scannerName} fallback init ook gefaald`, { error: String(fallbackErr) });\n                    reject(fallbackErr);\n                    return;\n                  }\n                  debugLog(`âœ… ${scannerName} initialized successfully (fallback)`);\n                  initSuccess = true;\n                  resolve();\n                });\n              } else {\n                reject(err);\n              }\n              return;\n            }\n            debugLog(`âœ… ${scannerName} initialized successfully`);\n            initSuccess = true;\n            \n            // Setup callbacks VOOR start() (zoals SeniorEase)\n            // Listen for frame processing (debugging) - simpel zoals SeniorEase\n            scanner.onProcessed((result: any) => {\n              if (result) {\n                // Quagga2: teken debug overlay\n                if (isQuagga2 && scanner.canvas?.ctx?.overlay && scanner.canvas?.dom?.overlay) {\n                  try {\n                    const ctx = scanner.canvas.ctx.overlay;\n                    const canvas = scanner.canvas.dom.overlay;\n                    ctx.clearRect(0, 0, canvas.width, canvas.height);\n                    \n                    // Teken boxes (blauw)\n                    if (result.boxes) {\n                      result.boxes\n                        .filter((box: any) => box !== result.box)\n                        .forEach((box: any) => {\n                          if (scanner.ImageDebug?.drawPath) {\n                            scanner.ImageDebug.drawPath(box, { x: 0, y: 1 }, ctx, {\n                              color: '#00F',\n                              lineWidth: 2\n                            });\n                          }\n                        });\n                    }\n                    \n                    // Teken hoofdbox (groen)\n                    if (result.box && scanner.ImageDebug?.drawPath) {\n                      scanner.ImageDebug.drawPath(result.box, { x: 0, y: 1 }, ctx, {\n                        color: '#0F0',\n                        lineWidth: 3\n                      });\n                    }\n                    \n                    // Teken scanline (rood/oranje)\n                    if (result.line && scanner.ImageDebug?.drawPath) {\n                      const lineColor = result.codeResult?.code ? 'red' : 'orange';\n                      scanner.ImageDebug.drawPath(result.line, { x: 'x', y: 'y' }, ctx, {\n                        color: lineColor,\n                        lineWidth: result.codeResult?.code ? 4 : 3\n                      });\n                    }\n                  } catch (e) {\n                    // Ignore errors\n                  }\n                }\n                \n                // Simpel logging zoals SeniorEase\n                if (result.codeResult) {\n                  debugLog('ðŸ“¦ Code gevonden in frame', { \n                    code: result.codeResult.code,\n                    format: result.codeResult.format\n                  });\n                }\n              }\n            });\n\n            // Listen for successful barcode detection - EXACT zoals SeniorEase\n            scanner.onDetected((result: any) => {\n              debugLog('ðŸŽ¯ Barcode gevonden!', { \n                code: result?.codeResult?.code,\n                format: result?.codeResult?.format\n              });\n              \n              // Check processing flag FIRST\n              if (isProcessingRef.current) {\n                debugLog('â¸ï¸ Scan already processing, ignoring callback');\n                return;\n              }\n              \n              if (result && result.codeResult) {\n                const code = result.codeResult.code;\n                debugLog('âœ… Processing detected code', { code });\n                \n                // Direct stoppen zoals SeniorEase\n                try {\n                  scanner.stop();\n                  debugLog('ðŸ›‘ Scanner stopped after detection');\n                } catch (e) {\n                  debugLog('âš ï¸ Error stopping scanner', { error: String(e) });\n                }\n                \n                // Process result\n                handleBarcodeResult(result.codeResult);\n              } else {\n                debugLog('âš ï¸ onDetected called but no codeResult in result');\n              }\n            });\n            \n            // Start scanning NA callbacks (zoals SeniorEase)\n            scanner.start();\n            debugLog(`âœ… ${scannerName} scanner started`);\n            \n            // Platform-specifieke video attributen instellen (iOS vereist playsinline en muted)\n            setTimeout(() => {\n              const video = container.querySelector('video');\n              if (video) {\n                if (isIOS) {\n                  video.setAttribute('playsinline', 'true');\n                  video.setAttribute('webkit-playsinline', 'true');\n                  video.setAttribute('muted', 'true');\n                  video.muted = true;\n                  debugLog('ðŸŽ iOS video attributen ingesteld', {\n                    playsinline: video.hasAttribute('playsinline'),\n                    muted: video.muted\n                  });\n                } else if (isAndroid) {\n                  video.setAttribute('playsinline', 'true');\n                  video.setAttribute('webkit-playsinline', 'true');\n                  debugLog('ðŸ“± Android video attributen ingesteld');\n                }\n              }\n            }, 200);\n            \n            resolve();\n          });\n        });\n      } catch (initError: any) {\n        debugLog(`âŒ ${scannerName} init gefaald`, { error: String(initError) });\n        throw initError;\n      }\n      \n    } catch (e) {\n      console.error('Camera error:', e);\n      setIsScanning(false);\n      \n      // Veilige error extractie - alleen primitieve waarden\n      let errorName = '';\n      let errorMessage = '';\n      let errorStack = '';\n      \n      if (e instanceof Error) {\n        errorName = e.name || '';\n        errorMessage = e.message || '';\n        errorStack = e.stack || '';\n      } else {\n        try {\n          errorMessage = String(e);\n        } catch {\n          errorMessage = 'Unknown error';\n        }\n      }\n      \n      // Log alleen veilige primitieve waarden\n      debugLog('âŒ Camera error details', { \n        error: errorMessage,\n        name: errorName,\n        hasStack: !!errorStack\n      });\n      \n      if (e instanceof Error) {\n        if (e.name === 'NotAllowedError' || e.name === 'PermissionDeniedError') {\n          setError('Camera toegang geweigerd. Geef toestemming in je browser instellingen.');\n        } else if (e.name === 'NotFoundError' || e.name === 'DevicesNotFoundError') {\n          setError('Geen camera gevonden op dit apparaat.');\n        } else if (e.name === 'NotReadableError' || e.name === 'TrackStartError') {\n          setError('Camera wordt al gebruikt door een andere app.');\n        } else if (errorMessage?.includes('getUserMedia')) {\n          setError('Camera toegang mislukt. Controleer je browser instellingen en zorg dat je HTTPS gebruikt.');\n        } else if (errorMessage?.includes('circular') || errorMessage?.includes('JSON')) {\n          setError('Camera initialisatie fout. Probeer de pagina te verversen.');\n        } else {\n          setError(`Camera fout: ${errorMessage || 'Onbekende fout'}`);\n        }\n      } else {\n        setError(`Camera initialisatie mislukt: ${errorMessage}`);\n      }\n    }\n  };\n\n  const stopCamera = () => {\n    debugLog('ðŸ›‘ Stopping camera...');\n    \n    // Stop scanner - dit stopt ook automatisch de video stream\n    const scanner = window.Quagga2 || window.Quagga;\n    if (scanner) {\n      try {\n        scanner.offDetected?.(); // Remove detection callback (Quagga2 heeft dit)\n        scanner.stop();\n        debugLog('âœ… Scanner stopped');\n      } catch (err) {\n        debugLog('âš ï¸ Error stopping scanner', { error: String(err) });\n        console.log('Error stopping scanner:', err);\n      }\n    }\n    \n    setIsScanning(false);\n  };\n\n  // Try OpenLibrary ISBN API - verbeterd met timeout en betere error handling\n  const tryOpenLibrary = async (isbn: string) => {\n    try {\n      debugLog('ðŸ” Trying OpenLibrary API', { isbn });\n      const url = `https://openlibrary.org/isbn/${isbn}.json`;\n      \n      // Timeout na 5 seconden\n      const controller = new AbortController();\n      const timeout = setTimeout(() => controller.abort(), 5000);\n      \n      try {\n        const response = await fetch(url, { signal: controller.signal });\n        clearTimeout(timeout);\n        \n        if (!response.ok) {\n          debugLog('âš ï¸ OpenLibrary response not OK', { status: response.status });\n          return null;\n        }\n        \n        const edition = await response.json();\n        \n        if (!edition.title) {\n          debugLog('âš ï¸ OpenLibrary: no title found');\n          return null;\n        }\n        \n        // Build basic book object\n        const data: any = {\n          title: edition.title,\n          publishYear: edition.publish_date || null,\n          pages: edition.number_of_pages || null,\n          isbn: isbn\n        };\n        \n        // Verbeterde auteur-ophaling: haal voor elke author key de naam op\n        if (Array.isArray(edition.authors) && edition.authors.length > 0) {\n          try {\n            const authorNames = await Promise.all(\n              edition.authors.map(async (a: any) => {\n                if (a?.key) {\n                  try {\n                    const authorRes = await fetch(`https://openlibrary.org${a.key}.json`, {\n                      signal: controller.signal\n                    });\n                    if (authorRes.ok) {\n                      const authorData = await authorRes.json();\n                      return authorData?.name as string;\n                    }\n                  } catch (e) {\n                    debugLog('âš ï¸ Error fetching author', { error: String(e) });\n                  }\n                }\n                return '';\n              })\n            );\n            const names = authorNames.filter((n) => n && n.trim().length > 0);\n            if (names.length > 0) {\n              data.author = names.join(', ');\n            }\n          } catch (e) {\n            debugLog('âš ï¸ Author lookup failed', { error: String(e) });\n          }\n        }\n        \n        // Attach cover image if available\n        if (Array.isArray(edition.covers) && edition.covers.length > 0) {\n          data.cover = `https://covers.openlibrary.org/b/id/${edition.covers[0]}-M.jpg`;\n        } else {\n          data.cover = `https://covers.openlibrary.org/b/isbn/${isbn}-M.jpg`;\n        }\n        \n        // Als de edition een work referentie heeft, haal extra metadata op\n        if (Array.isArray(edition.works) && edition.works.length > 0) {\n          try {\n            const workKey = edition.works[0].key;\n            const workRes = await fetch(`https://openlibrary.org${workKey}.json`, {\n              signal: controller.signal\n            });\n            if (workRes.ok) {\n              const work = await workRes.json();\n              data.title = data.title || work.title;\n              if (work.description) {\n                data.description = typeof work.description === 'string'\n                  ? work.description\n                  : work.description?.value;\n              }\n              if (work.subjects) {\n                data.subjects = work.subjects.slice(0, 5);\n              }\n            }\n          } catch (e) {\n            debugLog('âš ï¸ Could not fetch work details', { error: String(e) });\n          }\n        }\n        \n        if (!data.author) {\n          data.author = 'Onbekende auteur';\n        }\n        \n        debugLog('âœ… OpenLibrary success', { title: data.title, author: data.author });\n        return data;\n      } catch (fetchError) {\n        clearTimeout(timeout);\n        throw fetchError;\n      }\n    } catch (err) {\n      if (err instanceof Error && err.name === 'AbortError') {\n        debugLog('â±ï¸ OpenLibrary timeout');\n      } else {\n        debugLog('âŒ OpenLibrary failed', { error: String(err) });\n      }\n    }\n    return null;\n  };\n\n  // Try Google Books API - verbeterd met timeout en betere data parsing\n  const tryGoogleBooks = async (isbn: string) => {\n    try {\n      debugLog('ðŸ” Trying Google Books API', { isbn });\n      const url = `https://www.googleapis.com/books/v1/volumes?q=isbn:${isbn}`;\n      \n      // Timeout na 5 seconden\n      const controller = new AbortController();\n      const timeout = setTimeout(() => controller.abort(), 5000);\n      \n      try {\n        const response = await fetch(url, { signal: controller.signal });\n        clearTimeout(timeout);\n        \n        if (!response.ok) {\n          debugLog('âš ï¸ Google Books response not OK', { status: response.status });\n          return null;\n        }\n        \n        const data = await response.json();\n        \n        if (!data.items || data.items.length === 0) {\n          debugLog('âš ï¸ Google Books: no items found');\n          return null;\n        }\n        \n        const book = data.items[0].volumeInfo;\n        \n        // Parse authors - kan array zijn of undefined\n        let author = 'Onbekende auteur';\n        if (Array.isArray(book.authors) && book.authors.length > 0) {\n          author = book.authors.join(', ');\n        }\n        \n        // Parse cover image - probeer beste kwaliteit\n        let cover = null;\n        if (book.imageLinks) {\n          cover = book.imageLinks.large ||\n                  book.imageLinks.medium ||\n                  book.imageLinks.thumbnail ||\n                  book.imageLinks.smallThumbnail ||\n                  null;\n          // Upgrade naar https als http wordt gebruikt\n          if (cover && cover.startsWith('http:')) {\n            cover = cover.replace('http:', 'https:');\n          }\n        }\n        \n        const result = {\n          title: book.title || 'Onbekende titel',\n          author: author,\n          cover: cover,\n          isbn: isbn,\n          publishYear: book.publishedDate?.split('-')[0] || null,\n          pages: book.pageCount || null,\n          description: book.description || null,\n          subjects: book.categories || []\n        };\n        \n        debugLog('âœ… Google Books success', { title: result.title, author: result.author });\n        return result;\n      } catch (fetchError) {\n        clearTimeout(timeout);\n        throw fetchError;\n      }\n    } catch (err) {\n      if (err instanceof Error && err.name === 'AbortError') {\n        debugLog('â±ï¸ Google Books timeout');\n      } else {\n        debugLog('âŒ Google Books failed', { error: String(err) });\n      }\n    }\n    return null;\n  };\n\n  // Try UPCitemdb API - universal product database, gebruikt in Biblitoheek Android app\n  const tryUPCitemdb = async (isbn: string) => {\n    try {\n      debugLog('ðŸ” Trying UPCitemdb API', { isbn });\n      const url = `https://api.upcitemdb.com/prod/trial/lookup?upc=${isbn}`;\n      \n      // Timeout na 5 seconden\n      const controller = new AbortController();\n      const timeout = setTimeout(() => controller.abort(), 5000);\n      \n      try {\n        const response = await fetch(url, { signal: controller.signal });\n        clearTimeout(timeout);\n        \n        if (!response.ok) {\n          debugLog('âš ï¸ UPCitemdb response not OK', { status: response.status });\n          return null;\n        }\n        \n        const data = await response.json();\n        \n        if (!data.items || data.items.length === 0) {\n          debugLog('âš ï¸ UPCitemdb: no items found');\n          return null;\n        }\n        \n        const item = data.items[0];\n        \n        // Parse title - UPCitemdb returned vaak \"Title - Author\" format\n        let title = item.title || 'Onbekende titel';\n        let author = item.brand || 'Onbekende auteur';\n        \n        // Probeer te splitsen op common patterns\n        if (title.includes(' - ')) {\n          const parts = title.split(' - ', 2);\n          if (parts.length === 2 && parts[0].trim() && parts[1].trim()) {\n            author = parts[0].trim();\n            title = parts[1].trim();\n          }\n        } else if (title.includes(' / ')) {\n          const parts = title.split(' / ', 2);\n          if (parts.length === 2 && parts[0].trim() && parts[1].trim()) {\n            author = parts[0].trim();\n            title = parts[1].trim();\n          }\n        } else if (title.toLowerCase().includes(' by ')) {\n          const parts = title.split(/\\s+by\\s+/i, 2);\n          if (parts.length === 2 && parts[0].trim() && parts[1].trim()) {\n            title = parts[0].trim();\n            author = parts[1].trim();\n          }\n        }\n        \n        const result = {\n          title: title,\n          author: author,\n          cover: item.images?.[0] || `https://covers.openlibrary.org/b/isbn/${isbn}-M.jpg`,\n          isbn: isbn,\n          publishYear: null,\n          pages: null,\n          description: item.description || null,\n          subjects: []\n        };\n        \n        debugLog('âœ… UPCitemdb success', { title: result.title, author: result.author });\n        return result;\n      } catch (fetchError) {\n        clearTimeout(timeout);\n        throw fetchError;\n      }\n    } catch (err) {\n      if (err instanceof Error && err.name === 'AbortError') {\n        debugLog('â±ï¸ UPCitemdb timeout');\n      } else {\n        debugLog('âŒ UPCitemdb failed', { error: String(err) });\n      }\n    }\n    return null;\n  };\n\n  // Try OpenLibrary Works API (alternative endpoint via works)\n  const tryOpenLibraryWorks = async (isbn: string) => {\n    try {\n      const url = `https://openlibrary.org/isbn/${isbn}.json`;\n      console.log('Trying OpenLibrary Works:', url);\n      const response = await fetch(url);\n      if (!response.ok) return null;\n      const workData = await response.json();\n      \n      // Als er works zijn, haal work details op\n      if (workData.works && workData.works.length > 0) {\n        const workKey = workData.works[0].key;\n        const workUrl = `https://openlibrary.org${workKey}.json`;\n        const workResponse = await fetch(workUrl);\n        if (workResponse.ok) {\n          const work = await workResponse.json();\n          \n          // Haal auteurs op\n          let authors: string[] = [];\n          if (work.authors && work.authors.length > 0) {\n            const authorPromises = work.authors.slice(0, 3).map(async (author: any) => {\n              if (author.author?.key) {\n                try {\n                  const authorRes = await fetch(`https://openlibrary.org${author.author.key}.json`);\n                  if (authorRes.ok) {\n                    const authorData = await authorRes.json();\n                    return authorData.name || '';\n                  }\n                } catch (e) {\n                  console.error('Error fetching author:', e);\n                }\n              }\n              return '';\n            });\n            authors = (await Promise.all(authorPromises)).filter(a => a);\n          }\n          \n          // Haal beschrijving en onderwerpen op\n          let description: string | null = null;\n          let subjects: string[] = [];\n          \n          if (work.description) {\n            if (typeof work.description === 'string') {\n              description = work.description;\n            } else if (work.description.value) {\n              description = work.description.value;\n            }\n          }\n          \n          if (work.subjects) {\n            subjects = work.subjects.slice(0, 5);\n          }\n          \n          return {\n            title: work.title || workData.title || 'Onbekende titel',\n            author: authors.join(', ') || 'Onbekende auteur',\n            cover: `https://covers.openlibrary.org/b/isbn/${isbn}-M.jpg`,\n            isbn: isbn,\n            publishYear: work.first_publish_date || workData.publish_date || null,\n            pages: workData.number_of_pages || null,\n            description: description,\n            subjects: subjects\n          };\n        }\n      }\n    } catch (err) {\n      console.log('OpenLibrary Works failed:', err);\n    }\n    return null;\n  };\n\n  const lookupIsbn = async (isbn: string) => {\n    setIsLoading(true); \n    setError(''); \n    setScannedBook(null);\n    // isProcessingRef is al gezet in handleBarcodeResult\n    try {\n      const cleanIsbn = isbn.replace(/[^0-9X]/gi, '');\n      debugLog('ðŸ“š Looking up ISBN', { isbn: cleanIsbn });\n      \n      // Validate ISBN length (ISBN-10: 10 digits, ISBN-13: 13 digits)\n      if (cleanIsbn.length < 10 || cleanIsbn.length > 13) {\n        const errorMsg = 'Ongeldig ISBN nummer. ISBN moet 10 of 13 cijfers bevatten.';\n        debugLog('âŒ Invalid ISBN', { length: cleanIsbn.length });\n        setError(errorMsg);\n        setIsLoading(false);\n        return;\n      }\n      \n      // Try multiple APIs in sequence - verbeterde fallback strategie uit Biblitoheek\n      debugLog('ðŸ”„ Starting API fallback chain...');\n      let book = null;\n      \n      // 1. Probeer OpenLibrary (snelste en meest complete)\n      book = await tryOpenLibrary(cleanIsbn);\n      \n      // 2. Probeer Google Books (goede fallback)\n      if (!book) {\n        debugLog('ðŸ“– OpenLibrary failed, trying Google Books...');\n        book = await tryGoogleBooks(cleanIsbn);\n      }\n      \n      // 3. Probeer UPCitemdb (universal product database - gebruikt in Biblitoheek Android)\n      if (!book) {\n        debugLog('ðŸ“¦ Google Books failed, trying UPCitemdb...');\n        book = await tryUPCitemdb(cleanIsbn);\n      }\n      \n      // 4. Probeer OpenLibrary Works (alternatieve endpoint)\n      if (!book) {\n        debugLog('ðŸ” UPCitemdb failed, trying OpenLibrary Works...');\n        book = await tryOpenLibraryWorks(cleanIsbn);\n      }\n      \n      if (book) {\n        debugLog('âœ… Book found!', { \n          title: book.title, \n          author: book.author,\n          hasCover: !!book.cover \n        });\n        setScannedBook(book);\n      } else {\n        debugLog('âŒ Book not found in any API');\n        setError(`Boek met ISBN ${cleanIsbn} niet gevonden in online databases. Controleer het ISBN nummer en probeer het opnieuw.`);\n      }\n    } catch (err) {\n      debugLog('âŒ Error in lookupIsbn', { error: String(err) });\n      console.error('Error in lookupIsbn:', err);\n      if (err instanceof Error) {\n        // Check for network errors\n        if (err.message.includes('Failed to fetch') || err.message.includes('NetworkError')) {\n          setError('Geen internetverbinding. Controleer je verbinding en probeer het opnieuw.');\n        } else {\n          setError(`Er ging iets mis: ${err.message}`);\n        }\n      } else {\n        setError('Er ging iets mis bij het ophalen van boekgegevens. Probeer het later opnieuw.');\n      }\n    } finally {\n      setIsLoading(false);\n      // Reset processing flag na het voltooien van de lookup\n      isProcessingRef.current = false;\n    }\n  };\n\n  const handleManualSubmit = (e: React.FormEvent) => { e.preventDefault(); if (manualIsbn.trim()) lookupIsbn(manualIsbn); };\n\n  const saveBook = (status: 'reading' | 'tbr' | 'finished') => {\n    const savedBooks = JSON.parse(localStorage.getItem('shelfie-books') || '[]');\n    savedBooks.push({ ...scannedBook, status, id: Date.now() });\n    localStorage.setItem('shelfie-books', JSON.stringify(savedBooks));\n    setScannedBook(null); setManualIsbn('');\n    window.location.href = '/library';\n  };\n\n  // Handle Quagga2 script load (primair)\n  const handleQuagga2Load = () => {\n    debugLog('âœ… Quagga2 script loaded');\n    setQuagga2Loaded(true);\n    // Quagga2 exposeert zichzelf als window.Quagga2 of window.Quagga\n    if (window.Quagga2) {\n      debugLog('âœ… Quagga2 available as window.Quagga2');\n    } else if (window.Quagga) {\n      debugLog('âœ… Quagga2 available as window.Quagga');\n    }\n  };\n  \n  // Handle QuaggaJS script load (fallback)\n  const handleQuaggaLoad = () => {\n    debugLog('âœ… QuaggaJS script loaded');\n    setQuaggaLoaded(true);\n  };\n\n  return (\n    <main className=\"min-h-screen bg-surface-dark\">\n      {/* Load Quagga2 EERST (onderhouden versie met debug overlay) */}\n      <Script\n        src=\"https://unpkg.com/@ericblade/quagga2/dist/quagga.min.js\"\n        onLoad={handleQuagga2Load}\n        onError={() => {\n          debugLog('âš ï¸ Quagga2 niet geladen, gebruik QuaggaJS');\n        }}\n        strategy=\"lazyOnload\"\n        id=\"quagga2-script\"\n      />\n      {/* QuaggaJS als backup */}\n      <Script\n        src=\"https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js\"\n        onLoad={handleQuaggaLoad}\n        onError={() => {\n          debugLog('âŒ Failed to load QuaggaJS');\n          if (!quagga2Loaded) {\n            setError('Kon scanner niet laden. Controleer je internetverbinding.');\n          }\n        }}\n        strategy=\"lazyOnload\"\n        id=\"quagga-script\"\n      />\n      <div className=\"fixed inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-1/4 left-1/4 w-96 h-96 bg-primary/10 rounded-full blur-[150px]\" />\n        <div className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-secondary/10 rounded-full blur-[150px]\" />\n      </div>\n      <div className=\"relative z-10\">\n        <header className=\"sticky top-0 z-20 bg-surface-dark/80 backdrop-blur-lg border-b border-white/10\">\n          <div className=\"container mx-auto px-4 py-4\">\n            <div className=\"flex justify-between items-center\">\n              <Link href=\"/library\" className=\"flex items-center gap-2 text-neutral-400 hover:text-white\"><svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" /></svg>Back</Link>\n              <h1 className=\"font-display font-bold text-lg text-white\">Add Book</h1>\n              <button \n                onClick={() => setShowDebug(!showDebug)} \n                className=\"px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 text-white text-xs font-medium border border-white/20\"\n              >\n                {showDebug ? 'ðŸ”´ Debug ON' : 'âšª Debug'}\n              </button>\n            </div>\n          </div>\n        </header>\n        <div className=\"container mx-auto px-4 py-8\">\n          {scannedBook ? (\n            <div className=\"animate-scale-in\">\n              <div className=\"glass-card p-6 mb-6\">\n                <div className=\"flex gap-6 mb-4\">\n                  <div className=\"flex-shrink-0\">\n                    {scannedBook.cover ? <img src={scannedBook.cover} alt={scannedBook.title} className=\"w-28 h-40 rounded-xl object-cover shadow-lg\" /> : <div className=\"w-28 h-40 rounded-xl bg-surface-light flex items-center justify-center\"><span className=\"text-4xl\">ðŸ“š</span></div>}\n                  </div>\n                  <div className=\"flex-1\">\n                    <h2 className=\"text-white font-bold text-xl mb-1\">{scannedBook.title}</h2>\n                    <p className=\"text-neutral-400 mb-2\">{scannedBook.author}</p>\n                    {scannedBook.publishYear && <p className=\"text-neutral-500 text-sm mb-1\">ðŸ“… {scannedBook.publishYear}</p>}\n                    {scannedBook.pages && <p className=\"text-neutral-500 text-sm mb-1\">ðŸ“„ {scannedBook.pages} paginas</p>}\n                    <p className=\"text-neutral-600 text-xs mt-2\">ISBN: {scannedBook.isbn}</p>\n                  </div>\n                </div>\n                \n                {/* Beschrijving */}\n                {scannedBook.description && (\n                  <div className=\"mb-4\">\n                    <h3 className=\"text-white font-semibold text-sm mb-2\">Beschrijving</h3>\n                    <p className=\"text-neutral-300 text-sm leading-relaxed line-clamp-4\">\n                      {scannedBook.description.length > 300 \n                        ? scannedBook.description.substring(0, 300) + '...' \n                        : scannedBook.description}\n                    </p>\n                  </div>\n                )}\n                \n                {/* Onderwerpen */}\n                {scannedBook.subjects && scannedBook.subjects.length > 0 && (\n                  <div>\n                    <h3 className=\"text-white font-semibold text-sm mb-2\">Onderwerpen</h3>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {scannedBook.subjects.map((subject: string, index: number) => (\n                        <span key={index} className=\"px-3 py-1 rounded-full bg-primary/20 text-primary-light text-xs\">\n                          {subject}\n                        </span>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n              <div className=\"space-y-3\">\n                <p className=\"text-neutral-400 text-center mb-4\">Add to shelf as:</p>\n                <button onClick={() => saveBook('reading')} className=\"w-full glass-card-hover p-4 flex items-center gap-4\"><div className=\"w-12 h-12 rounded-xl bg-primary/20 flex items-center justify-center\"><span className=\"text-2xl\">ðŸ“–</span></div><div className=\"text-left\"><p className=\"text-white font-semibold\">Currently Reading</p><p className=\"text-neutral-400 text-sm\">I am reading this now</p></div></button>\n                <button onClick={() => saveBook('tbr')} className=\"w-full glass-card-hover p-4 flex items-center gap-4\"><div className=\"w-12 h-12 rounded-xl bg-secondary/20 flex items-center justify-center\"><span className=\"text-2xl\">ðŸ“š</span></div><div className=\"text-left\"><p className=\"text-white font-semibold\">To Be Read (TBR)</p><p className=\"text-neutral-400 text-sm\">On my reading list</p></div></button>\n                <button onClick={() => saveBook('finished')} className=\"w-full glass-card-hover p-4 flex items-center gap-4\"><div className=\"w-12 h-12 rounded-xl bg-accent/20 flex items-center justify-center\"><span className=\"text-2xl\">âœ…</span></div><div className=\"text-left\"><p className=\"text-white font-semibold\">Finished</p><p className=\"text-neutral-400 text-sm\">Already read this one</p></div></button>\n              </div>\n              <button onClick={() => setScannedBook(null)} className=\"w-full mt-6 text-neutral-400 hover:text-white py-3\">Scan another book</button>\n            </div>\n          ) : (\n            <>\n              <div className=\"glass-card p-6 mb-6\">\n                {isScanning ? (\n                  <div className=\"relative pb-24\">\n                    {/* Quagga container - Quagga zal hier automatisch een video element in plaatsen */}\n                    <div \n                      id=\"quagga-container\" \n                      className=\"w-full h-64 md:h-96 rounded-xl overflow-hidden bg-black relative\"\n                      style={{ transform: 'scaleX(1)' }}\n                    />\n                    {/* CSS voor overlay canvas - moet BOVENOP alles liggen (zoals SeniorEase) */}\n                    <style jsx global>{`\n                      #quagga-container {\n                        position: relative !important;\n                      }\n                      #quagga-container video {\n                        position: relative !important;\n                        z-index: 1 !important;\n                        width: 100% !important;\n                        height: 100% !important;\n                        object-fit: cover !important;\n                      }\n                      #quagga-container canvas.drawingBuffer {\n                        display: block !important;\n                        position: absolute !important;\n                        z-index: 3 !important;\n                        top: 0 !important;\n                        left: 0 !important;\n                        width: 100% !important;\n                        height: 100% !important;\n                        pointer-events: none !important;\n                      }\n                      /* Alle andere canvas elementen ook bovenop */\n                      #quagga-container canvas {\n                        position: absolute !important;\n                        top: 0 !important;\n                        left: 0 !important;\n                        z-index: 3 !important;\n                      }\n                    `}</style>\n                    {/* Scanning frame overlay - onder canvas maar boven video */}\n                    <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none z-[2]\">\n                      <div className=\"w-64 h-40 md:w-80 md:h-48 border-2 border-primary rounded-lg relative shadow-lg\">\n                        {/* Corner markers */}\n                        <div className=\"absolute top-0 left-0 w-6 h-6 border-t-4 border-l-4 border-primary rounded-tl-lg\" />\n                        <div className=\"absolute top-0 right-0 w-6 h-6 border-t-4 border-r-4 border-primary rounded-tr-lg\" />\n                        <div className=\"absolute bottom-0 left-0 w-6 h-6 border-b-4 border-l-4 border-primary rounded-bl-lg\" />\n                        <div className=\"absolute bottom-0 right-0 w-6 h-6 border-b-4 border-r-4 border-primary rounded-br-lg\" />\n                        {/* Scanning line */}\n                        <div className=\"absolute left-2 right-2 h-1 bg-primary animate-pulse shadow-lg\" style={{ top: '50%', boxShadow: '0 0 10px rgba(168, 85, 247, 0.8)' }} />\n                      </div>\n                    </div>\n                    {/* Close button */}\n                    <button \n                      onClick={stopCamera} \n                      className=\"absolute top-4 right-4 bg-black/70 hover:bg-black/90 backdrop-blur-sm p-3 rounded-full text-white transition-all z-20\"\n                      aria-label=\"Stop camera\"\n                    >\n                      <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                      </svg>\n                    </button>\n                    {/* Instructions - buiten de video container */}\n                    <div className=\"absolute -bottom-16 left-0 right-0 px-4 z-20\">\n                      <p className=\"text-center text-white text-sm font-medium mb-1 bg-black/70 backdrop-blur-sm rounded-full py-2 px-4 inline-block\">\n                        ðŸ“· Richt de camera op de barcode\n                      </p>\n                      <p className=\"text-center text-neutral-300 text-xs mt-2\">\n                        Zorg dat de barcode goed verlicht is\n                      </p>\n                      {/* Debug toggle tijdens scanning */}\n                      <button \n                        onClick={() => setShowDebug(!showDebug)} \n                        className=\"mt-3 mx-auto block px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 text-white text-xs font-medium border border-white/20\"\n                      >\n                        {showDebug ? 'ðŸ”´ Debug OFF' : 'âšª Debug ON'}\n                      </button>\n                    </div>\n                  </div>\n                ) : (\n                  <button onClick={startCamera} className=\"w-full h-48 rounded-xl border-2 border-dashed border-white/20 flex flex-col items-center justify-center gap-4 hover:border-primary/50 hover:bg-white/5 transition-all\">\n                    <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center\"><svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\" /></svg></div>\n                    <div className=\"text-center\"><p className=\"text-white font-semibold\">Scan ISBN Barcode</p><p className=\"text-neutral-400 text-sm\">Tap to open camera</p></div>\n                  </button>\n                )}\n              </div>\n              <div className=\"flex items-center gap-4 my-6\"><div className=\"flex-1 h-px bg-white/10\" /><span className=\"text-neutral-500 text-sm\">or enter manually</span><div className=\"flex-1 h-px bg-white/10\" /></div>\n              <form onSubmit={handleManualSubmit} className=\"space-y-4\">\n                <div><label htmlFor=\"isbn\" className=\"block text-sm text-neutral-400 mb-2\">ISBN Number</label><input type=\"text\" id=\"isbn\" value={manualIsbn} onChange={(e) => setManualIsbn(e.target.value)} placeholder=\"Voer ISBN in (bijv. 9789401609236)\" className=\"input-modern\" /></div>\n                {error && <div className=\"p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-sm\">{error}</div>}\n                <button type=\"submit\" disabled={isLoading || !manualIsbn.trim()} className=\"w-full btn-gradient py-4 disabled:opacity-50\">{isLoading ? 'Searching...' : 'Look up book'}</button>\n              </form>\n              <div className=\"mt-8 glass-card p-4\">\n                <p className=\"text-neutral-500 text-sm mb-3\">Try these popular BookTok reads:</p>\n                <div className=\"flex flex-wrap gap-2\">\n                  {[{ isbn: '9780062060624', title: 'Song of Achilles' }, { isbn: '9781649374042', title: 'Fourth Wing' }, { isbn: '9780316769174', title: 'Catcher in the Rye' }].map((book) => (\n                    <button key={book.isbn} onClick={() => { \n                      console.log('Button clicked for:', book.title, 'ISBN:', book.isbn);\n                      setManualIsbn(book.isbn); \n                      lookupIsbn(book.isbn); \n                    }} className=\"px-3 py-1.5 rounded-full bg-white/5 text-neutral-400 text-sm hover:bg-primary/20 hover:text-primary-light\">{book.title}</button>\n                  ))}\n                </div>\n              </div>\n            </>\n          )}\n          \n          {/* Debug Panel */}\n          {showDebug && (\n            <div className=\"fixed bottom-16 left-0 right-0 bg-black/90 backdrop-blur-lg border-t border-white/10 z-50 max-h-[50vh] overflow-hidden flex flex-col\">\n              <div className=\"flex justify-between items-center p-3 border-b border-white/10\">\n                <h3 className=\"text-white font-semibold text-sm\">Debug Logs</h3>\n                <div className=\"flex gap-2\">\n                  <button \n                    onClick={() => setDebugLogs([])} \n                    className=\"text-neutral-400 hover:text-white text-xs px-2 py-1\"\n                  >\n                    Clear\n                  </button>\n                  <button \n                    onClick={() => setShowDebug(false)} \n                    className=\"text-neutral-400 hover:text-white text-xs px-2 py-1\"\n                  >\n                    âœ•\n                  </button>\n                </div>\n              </div>\n              <div className=\"overflow-y-auto p-3 space-y-1\">\n                {debugLogs.length === 0 ? (\n                  <p className=\"text-neutral-500 text-xs\">Geen logs nog...</p>\n                ) : (\n                  debugLogs.map((log, index) => (\n                    <div key={index} className=\"text-xs font-mono text-neutral-300 break-words\">\n                      {log}\n                    </div>\n                  ))\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n        <nav className=\"fixed bottom-0 left-0 right-0 bg-surface-dark/90 backdrop-blur-lg border-t border-white/10\">\n          <div className=\"container mx-auto px-4\"><div className=\"flex justify-around py-2\">\n            <Link href=\"/library\" className=\"nav-item\"><svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253\" /></svg><span className=\"text-xs\">Library</span></Link>\n            <Link href=\"/scan\" className=\"nav-item active\"><svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h2M4 12h2m14 0h2M6 20h2m-4-8h2m14 0h2\" /></svg><span className=\"text-xs\">Scan</span></Link>\n            <Link href=\"/stats\" className=\"nav-item\"><svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" /></svg><span className=\"text-xs\">Stats</span></Link>\n            <Link href=\"/profile\" className=\"nav-item\"><svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" /></svg><span className=\"text-xs\">Profile</span></Link>\n          </div></div>\n        </nav>\n      </div>\n    </main>\n  );\n}\n\n"],"names":[],"mappings":"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"}}]
}